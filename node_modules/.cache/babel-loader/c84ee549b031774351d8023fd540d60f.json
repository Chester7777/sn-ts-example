{"ast":null,"code":"import _objectSpread from\"C:/React/reactProject/sn-ts-example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{authAPI}from\"../API/API\";import{stopSubmit}from\"redux-form\";var SET_USER_DATA=\"SET_USER_DATA\";// export type InitialStateType = {\n//     data: DataPropsType\n//     resultCode?: number\n//     messages?: Array<string>\n// }\n//\n// обьект initialState задает начальное значение state, если он не придет сразу\nvar initialState={userId:'',email:null,login:null,isAuth:false};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER_DATA:return _objectSpread(_objectSpread({},state),{},{userId:action.payload.userId,email:action.payload.email,login:action.payload.login,isAuth:action.payload.isAuth});default:return state;}};export var setAuthUserData=function setAuthUserData(userId,email,login,isAuth){return{type:SET_USER_DATA,payload:{userId:userId,email:email,login:login,isAuth:isAuth}};};export var getAuthUserData=function getAuthUserData(){return function(dispatch){return authAPI.me().then(function(data){if(data.data.resultCode===0){var _data$data$data=data.data.data,id=_data$data$data.id,email=_data$data$data.email,_login=_data$data$data.login;dispatch(setAuthUserData(id,email,_login,true));}});};};export var login=function login(email,password){var rememberMe=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return function(dispatch){authAPI.login(email,password,rememberMe).then(function(response){if(response.data.resultCode===0){dispatch(getAuthUserData());}else{var message=response.data.messages.length>10?response.data.messages[0]:\"Some error\";dispatch(stopSubmit(\"login\",{_error:message}));}});};};export var logout=function logout(){return function(dispatch){authAPI.loginAuth().then(function(response){if(response.data.resultCode===0){dispatch(setAuthUserData('',null,null,false));}});};};export default authReducer;","map":{"version":3,"sources":["C:/React/reactProject/sn-ts-example/src/redux/auth-reducer.ts"],"names":["authAPI","stopSubmit","SET_USER_DATA","initialState","userId","email","login","isAuth","authReducer","state","action","type","payload","setAuthUserData","getAuthUserData","dispatch","me","then","data","resultCode","id","password","rememberMe","response","message","messages","length","_error","logout","loginAuth"],"mappings":"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","sourcesContent":["import {Dispatch} from \"redux\";\r\nimport {authAPI} from \"../API/API\";\r\nimport {FormAction, stopSubmit} from \"redux-form\";\r\nimport {ThunkDispatch} from \"redux-thunk\";\r\nimport {AllAppStateType} from \"./Redux-store\";\r\n\r\nconst SET_USER_DATA = \"SET_USER_DATA\";\r\n\r\n\r\nexport type InitialStateType = {\r\n    userId: string\r\n    email: string | null\r\n    login: string | null\r\n    isAuth: boolean\r\n}\r\nexport type PostPropsType = {\r\n    id: null,\r\n    email: null,\r\n    login: null,\r\n    resultCode?: number\r\n    messages?: Array<string>\r\n}\r\n// export type InitialStateType = {\r\n//     data: DataPropsType\r\n//     resultCode?: number\r\n//     messages?: Array<string>\r\n// }\r\n//\r\n\r\n// обьект initialState задает начальное значение state, если он не придет сразу\r\nlet initialState: InitialStateType = {\r\n    userId: '',\r\n    email: null,\r\n    login: null,\r\n    isAuth: false\r\n}\r\n\r\nconst authReducer = (state = initialState, action: SetAuthUserDataAction): InitialStateType => {\r\n    switch (action.type) {\r\n        case SET_USER_DATA:\r\n            return {\r\n                ...state,\r\n                userId: action.payload.userId,\r\n                email: action.payload.email,\r\n                login: action.payload.login,\r\n                isAuth: action.payload.isAuth\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport type SetAuthUserDataAction = {\r\n    type: typeof SET_USER_DATA\r\n    payload: InitialStateType\r\n}\r\n\r\nexport const setAuthUserData = (userId: string, email: string | null, login: string | null, isAuth: boolean): SetAuthUserDataAction => ({\r\n    type: SET_USER_DATA, payload: {userId, email, login, isAuth}\r\n} as const)\r\n\r\nexport const getAuthUserData = () => (dispatch: Dispatch) => {\r\n    return authAPI.me()\r\n        .then((data) => {\r\n            if (data.data.resultCode === 0) {\r\n                let {id, email, login} = data.data.data\r\n                dispatch(setAuthUserData(id, email, login, true));\r\n            }\r\n        })\r\n}\r\nexport const login = (email: string, password: number, rememberMe: boolean = false) => (dispatch: ThunkDispatch<AllAppStateType, unknown, SetAuthUserDataAction | FormAction>) => {\r\n    authAPI.login(email, password, rememberMe)\r\n        .then((response) => {\r\n            if (response.data.resultCode === 0) {\r\n                dispatch(getAuthUserData());\r\n            } else {\r\n                let message = response.data.messages.length > 10 ? response.data.messages[0] : \"Some error\"\r\n                dispatch(stopSubmit(\"login\", {_error: message}));\r\n            }\r\n        })\r\n}\r\nexport const logout = () => (dispatch: Dispatch) => {\r\n    authAPI.loginAuth()\r\n        .then((response) => {\r\n            if (response.data.resultCode === 0) {\r\n                dispatch(setAuthUserData('', null, null, false));\r\n            }\r\n        })\r\n}\r\n\r\nexport default authReducer;"]},"metadata":{},"sourceType":"module"}