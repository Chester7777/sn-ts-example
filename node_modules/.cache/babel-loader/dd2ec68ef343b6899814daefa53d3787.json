{"ast":null,"code":"import _regeneratorRuntime from\"C:/React/reactProject/sn-ts-example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/React/reactProject/sn-ts-example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:/React/reactProject/sn-ts-example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/React/reactProject/sn-ts-example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{profileAPI}from\"../API/API\";import{stopSubmit}from\"redux-form\";var ADD_POST=\"ADD-POST\";var DELETE_POST=\"DELETE_POST\";var SET_USER_PROFILE=\"SET_USER_PROFILE\";var SET_STATUS=\"SET_STATUS\";var SAVE_PHOTO_SUCCESS=\"SAVE_PHOTO_SUCCESS\";// обьект initialState задает начальное значение state, если он не придет сразу\nvar initialState={posts:[{id:1,message:\"Hey, why nobody love me\",likes:\"15\"},{id:2,message:\"It`s our new program! Hey\",likes:\"20\"}],profile:null,status:\"\"};// обьект initialState задает начальное значение state, если он не придет сразу\nvar profilePageReducer=function profilePageReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case ADD_POST:var newPost={id:3,message:action.newPostText,likes:\"0\"};return _objectSpread(_objectSpread({},state),{},{posts:[].concat(_toConsumableArray(state.posts),[newPost])});case DELETE_POST:return _objectSpread(_objectSpread({},state),{},{posts:state.posts.filter(function(p){return p.id!=action.postId;})});case SET_USER_PROFILE:return _objectSpread(_objectSpread({},state),{},{profile:action.profile});case SET_STATUS:return _objectSpread(_objectSpread({},state),{},{status:action.status});case SAVE_PHOTO_SUCCESS:return _objectSpread(_objectSpread({},state),{},{profile:state.profile&&_objectSpread(_objectSpread({},state.profile),{},{photos:action.photos})});default:return state;}};export var addPostsActionCreator=function addPostsActionCreator(newPostText){return{type:ADD_POST,newPostText:newPostText};};export var deletePostsActionCreator=function deletePostsActionCreator(postId){return{type:DELETE_POST,postId:postId};};export var setUserProfile=function setUserProfile(profile){return{type:SET_USER_PROFILE,profile:profile};};export var setStatus=function setStatus(status){return{type:SET_STATUS,status:status};};export var savePhotoSuccess=function savePhotoSuccess(photos){return{type:SAVE_PHOTO_SUCCESS,photos:photos};};export var getUserProfile=function getUserProfile(userId){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return profileAPI.getProfile(userId);case 2:response=_context.sent;dispatch(setUserProfile(response.data));case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var getStatus=function getStatus(userId){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return profileAPI.getStatus(userId);case 2:response=_context2.sent;dispatch(setStatus(response.data));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var updateStatus=function updateStatus(status){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return profileAPI.updateStatus(status);case 2:response=_context3.sent;if(response.data.resultCode===0){dispatch(setStatus(status));}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var savePhoto=function savePhoto(file){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return profileAPI.savePhoto(file);case 2:response=_context4.sent;if(response.data.resultCode===0){dispatch(savePhotoSuccess(response.data.data.photos));}case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var saveProfile=function saveProfile(profile){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch,getState){var userId,response;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:debugger;userId=getState().auth.userId;_context5.next=4;return profileAPI.saveProfile(profile);case 4:response=_context5.sent;if(!(response.data.resultCode===0)){_context5.next=9;break;}dispatch(getUserProfile(userId));_context5.next=11;break;case 9:dispatch(stopSubmit(\"edit-profile\",{_error:response.data.messages[0]}));return _context5.abrupt(\"return\",Promise.reject(response.data.messages[0]));case 11:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x5,_x6){return _ref5.apply(this,arguments);};}();};export default profilePageReducer;","map":{"version":3,"sources":["C:/React/reactProject/sn-ts-example/src/redux/profilePage-reducer.ts"],"names":["profileAPI","stopSubmit","ADD_POST","DELETE_POST","SET_USER_PROFILE","SET_STATUS","SAVE_PHOTO_SUCCESS","initialState","posts","id","message","likes","profile","status","profilePageReducer","state","action","type","newPost","newPostText","filter","p","postId","photos","addPostsActionCreator","deletePostsActionCreator","setUserProfile","setStatus","savePhotoSuccess","getUserProfile","userId","dispatch","getProfile","response","data","getStatus","updateStatus","resultCode","savePhoto","file","saveProfile","getState","auth","_error","messages","Promise","reject"],"mappings":"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","sourcesContent":["import {profileAPI} from \"../API/API\";\r\nimport {Dispatch} from \"redux\";\r\nimport {ThunkAction} from \"redux-thunk\";\r\nimport {FormAction, stopSubmit} from \"redux-form\";\r\nimport {AllAppStateType} from \"./Redux-store\";\r\n\r\n\r\nconst ADD_POST = \"ADD-POST\";\r\nconst DELETE_POST = \"DELETE_POST\";\r\nconst SET_USER_PROFILE = \"SET_USER_PROFILE\";\r\nconst SET_STATUS = \"SET_STATUS\";\r\nconst SAVE_PHOTO_SUCCESS = \"SAVE_PHOTO_SUCCESS\";\r\n\r\nexport type PostsType = {\r\n    id: number\r\n    message: string\r\n    likes: string\r\n}\r\nexport type ContactsType = {\r\n    facebook: string,\r\n    website: null,\r\n    vk: string,\r\n    twitter: string,\r\n    instagram: string,\r\n    youtube: null,\r\n    github: string,\r\n    mainLink: null\r\n}\r\ntype PhotosType = {\r\n    small: string,\r\n    large: string\r\n}\r\nexport type ProfilePropsType = {\r\n    aboutMe: string,\r\n    contacts: ContactsType,\r\n    lookingForAJob: boolean,\r\n    lookingForAJobDescription: string,\r\n    fullName: string,\r\n    userId: number,\r\n    photos: PhotosType\r\n}\r\nexport type StatusProfileType = {\r\n    resultCode: number,\r\n    message: string,\r\n    data: {\r\n        resultCode: number\r\n        messages: string[],\r\n        data: {}\r\n    }\r\n}\r\n\r\n\r\nexport type InitialStateType = typeof initialState\r\n// обьект initialState задает начальное значение state, если он не придет сразу\r\nlet initialState = {\r\n    posts: [\r\n        {id: 1, message: \"Hey, why nobody love me\", likes: \"15\"},\r\n        {id: 2, message: \"It`s our new program! Hey\", likes: \"20\"},\r\n    ] as Array<PostsType>,\r\n    profile: null as ProfilePropsType | null,\r\n    status: \"\"\r\n}\r\n\r\n// обьект initialState задает начальное значение state, если он не придет сразу\r\nconst profilePageReducer = (state: InitialStateType = initialState, action: ProfileActionType): InitialStateType => {\r\n    switch (action.type) {\r\n        case ADD_POST:\r\n            const newPost = {\r\n                id: 3,\r\n                message: action.newPostText,\r\n                likes: \"0\"\r\n            };\r\n            return {\r\n                ...state,\r\n                posts: [...state.posts, newPost]\r\n            };\r\n        case DELETE_POST:\r\n            return {\r\n                ...state,\r\n                posts: state.posts.filter(p => p.id != action.postId)\r\n            };\r\n        case SET_USER_PROFILE:\r\n            return {\r\n                ...state,\r\n                profile: action.profile\r\n            };\r\n        case SET_STATUS:\r\n            return {\r\n                ...state,\r\n                status: action.status\r\n            };\r\n        case SAVE_PHOTO_SUCCESS:\r\n            return {\r\n                ...state,\r\n                profile: state.profile && {...state.profile, photos: action.photos}\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n\r\n}\r\nexport const addPostsActionCreator = (newPostText: string) => ({type: ADD_POST, newPostText} as const);\r\nexport const deletePostsActionCreator = (postId: number) => ({type: DELETE_POST, postId} as const);\r\nexport const setUserProfile = (profile: ProfilePropsType) => ({type: SET_USER_PROFILE, profile} as const);\r\nexport const setStatus = (status: string) => ({type: SET_STATUS, status} as const);\r\nexport const savePhotoSuccess = (photos: PhotosType) => ({type: SAVE_PHOTO_SUCCESS, photos} as const);\r\n\r\ntype MyType = ThunkAction<void, AllAppStateType, unknown, ProfileActionType | FormAction>\r\n\r\nexport const getUserProfile = (userId: string): MyType => async (dispatch: Dispatch<ProfileActionType>) => {\r\n    let response = await profileAPI.getProfile(userId);\r\n    dispatch(setUserProfile(response.data));\r\n}\r\nexport const getStatus = (userId: string): MyType => async (dispatch: Dispatch) => {\r\n    let response = await profileAPI.getStatus(userId);\r\n    dispatch(setStatus(response.data))\r\n}\r\nexport const updateStatus = (status: string): MyType => async (dispatch: Dispatch) => {\r\n    let response = await profileAPI.updateStatus(status);\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(setStatus(status))\r\n    }\r\n}\r\nexport const savePhoto = (file: string): MyType => async (dispatch: Dispatch) => {\r\n    let response = await profileAPI.savePhoto(file);\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(savePhotoSuccess(response.data.data.photos))\r\n    }\r\n}\r\n\r\nexport const saveProfile = (profile: ProfilePropsType): MyType => async (dispatch, getState) => {\r\n    debugger\r\n    const userId = getState().auth.userId\r\n    let response = await profileAPI.saveProfile(profile);\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(getUserProfile(userId))\r\n    } else {\r\n        dispatch(stopSubmit(\"edit-profile\", {_error: response.data.messages[0]}))\r\n        return Promise.reject(response.data.messages[0])\r\n    }\r\n}\r\n\r\n\r\nexport type ProfileActionType =\r\n    ReturnType<typeof addPostsActionCreator> |\r\n    ReturnType<typeof deletePostsActionCreator> |\r\n    ReturnType<typeof setUserProfile> |\r\n    ReturnType<typeof setStatus> |\r\n    ReturnType<typeof savePhotoSuccess>\r\n\r\nexport default profilePageReducer;"]},"metadata":{},"sourceType":"module"}